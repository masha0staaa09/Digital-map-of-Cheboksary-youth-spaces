<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CHEB-PLACE ‚Äî –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>

<header class="header">
    <div class="container header-inner">
        <div class="logo">
            <span class="logo-icon">
                <span class="logo-pin"></span>
            </span>
            <span class="logo-text">CHEB-PLACE</span>
        </div>
        <nav class="nav">
            <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="events.html">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
            <a href="reviews.html">–û—Ç–∑—ã–≤—ã</a>
            <a href="gallery.html">–ì–∞–ª–µ—Ä–µ—è</a>
            <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </nav>
    </div>
</header>

<main class="container">
    <section class="section">
        <h1>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
        <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∏ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–π –∂–∏–∑–Ω—å—é –ß–µ–±–æ–∫—Å–∞—Ä: –∫–∏–Ω–æ, —Ç–µ–∞—Ç—Ä—ã, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≥–æ—Ä–æ–¥—Å–∫–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.</p>

        <!-- –ë–ª–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div class="event-categories">
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´–ö–∏–Ω–æ¬ª -->
            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—Ñ–∏—à—É –∫–∏–Ω–æ: https://afisha21.ru/kino/?ysclid=ml9b53x5lb761427821 -->
            <a href="https://afisha21.ru/kino/?ysclid=ml9b53x5lb761427821"
               class="event-category-card"
               target="_blank"
               rel="noopener noreferrer">
                <div class="event-category-icon">üé¨</div>
                <div class="event-category-title">–ö–∏–Ω–æ</div>
                <div class="event-category-subtitle">–ù–æ–≤—ã–µ —Ñ–∏–ª—å–º—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑—ã.</div>
            </a>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´–¢–µ–∞—Ç—Ä—ã¬ª -->
            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—Ñ–∏—à—É —Ç–µ–∞—Ç—Ä–æ–≤: https://afisha21.ru/teatr/?ysclid=ml9bujruc124914308 -->
            <a href="https://afisha21.ru/teatr/?ysclid=ml9bujruc124914308"
               class="event-category-card"
               target="_blank"
               rel="noopener noreferrer">
                <div class="event-category-icon">üé≠</div>
                <div class="event-category-title">–¢–µ–∞—Ç—Ä—ã</div>
                <div class="event-category-subtitle">–°–ø–µ–∫—Ç–∞–∫–ª–∏, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –ø—Ä–µ–º—å–µ—Ä—ã.</div>
            </a>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏¬ª -->
            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: https://lib21.ru/page.php?target=post&category=2&ysclid=ml9bxm7lii347677505 -->
            <a href="https://lib21.ru/page.php?target=post&category=2&ysclid=ml9bxm7lii347677505"
               class="event-category-card"
               target="_blank"
               rel="noopener noreferrer">
                <div class="event-category-icon">üìö</div>
                <div class="event-category-title">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏</div>
                <div class="event-category-subtitle">–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –≤–µ—á–µ—Ä–∞ –∏ –∫–ª—É–±—ã –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º.</div>
            </a>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è ¬´–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è¬ª -->
            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—Ñ–∏—à–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π: https://afisha21.ru/active.htm?ysclid=ml9c1m4ddn165521245 -->
            <a href="https://afisha21.ru/active.htm?ysclid=ml9c1m4ddn165521245"
               class="event-category-card"
               target="_blank"
               rel="noopener noreferrer">
                <div class="event-category-icon">üé°</div>
                <div class="event-category-title">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</div>
                <div class="event-category-subtitle">–ö–∞—Ç–∫–∏, –ø–∞—Ä–∫–∏, –ª–æ–¥–æ—á–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ –∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª–∏.</div>
            </a>
        </div>

        <!-- –ë–ª–æ–∫ ¬´–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ¬ª –æ—Å—Ç–∞—ë—Ç—Å—è —Ä–∞–±–æ—á–∏–º –∏ –∏–¥—ë—Ç –Ω–∏–∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="card form-card" style="margin-top: 16px;">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h3>
            <!--
              –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Ç–∞–∫–∏–µ —Ñ–æ—Ä–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å).
              –ó–¥–µ—Å—å –¥–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –∫ API.
            -->
            <form id="event-form">
                <label>
                    –ó–∞–≥–æ–ª–æ–≤–æ–∫
                    <input type="text" name="title" required>
                </label>
                <label>
                    –î–∞—Ç–∞
                    <input type="date" name="date" required>
                </label>
                <label>
                    –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞)
                    <input type="text" name="short_info" maxlength="255" required>
                </label>
                <label>
                    URL –æ–±–ª–æ–∂–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    <input type="text" name="cover_url" placeholder="https://...">
                </label>
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
                <p id="event-form-message" class="form-message"></p>
            </form>
        </div>

        <h2 style="margin-top: 32px;">–°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h2>
        <p class="place-meta">
            –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è. –ò—Ö –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å
            (–¥–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π –¥–µ–π—Å—Ç–≤–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä—è–º–æ —Å —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã).
        </p>
        <div id="events-list" class="card-grid"></div>
    </section>
</main>

<footer class="footer">
    <div class="container">
        <p>–ü—Ä–æ–µ–∫—Ç ¬´CHEB-PLACE¬ª ‚Äî —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ü–∏—Ñ—Ä–æ–≤–æ–π –∫–∞—Ä—Ç—ã –º–æ–ª–æ–¥–µ–∂–Ω—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –ß–µ–±–æ–∫—Å–∞—Ä.</p>
    </div>
</footer>

<script>
// –ü—Ä–æ—Å—Ç–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
async function fetchJSON(url) {
    const res = await fetch(url);
    if (!res.ok) {
        throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: " + res.status);
    }
    return await res.json();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
async function loadEvents() {
    const container = document.getElementById("events-list");
    container.innerHTML = "";
    try {
        const events = await fetchJSON("/events");
        if (!events.length) {
            container.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.";
            return;
        }
        events.forEach(ev => {
            const card = document.createElement("div");
            card.className = "card";

            const title = document.createElement("h3");
            title.textContent = ev.title;

            const meta = document.createElement("div");
            meta.className = "place-meta";
            meta.textContent = new Date(ev.date).toLocaleDateString("ru-RU");

            const info = document.createElement("p");
            info.textContent = ev.short_info;

            card.appendChild(title);
            card.appendChild(meta);
            card.appendChild(info);

            if (ev.cover_url) {
                const img = document.createElement("img");
                img.src = ev.cover_url;
                img.alt = "–û–±–ª–æ–∂–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è";
                img.style.maxWidth = "100%";
                img.style.borderRadius = "8px";
                card.appendChild(img);
            }

            // –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
            const actions = document.createElement("div");
            actions.style.marginTop = "8px";

            const editBtn = document.createElement("button");
            editBtn.type = "button";
            editBtn.textContent = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å";
            editBtn.style.marginRight = "8px";
            editBtn.addEventListener("click", () => editEvent(ev));

            const deleteBtn = document.createElement("button");
            deleteBtn.type = "button";
            deleteBtn.textContent = "–£–¥–∞–ª–∏—Ç—å";
            deleteBtn.style.backgroundColor = "#e24c4c";
            deleteBtn.style.marginTop = "4px";
            deleteBtn.addEventListener("click", () => deleteEvent(ev.id));

            actions.appendChild(editBtn);
            actions.appendChild(deleteBtn);
            card.appendChild(actions);

            container.appendChild(card);
        });
    } catch (e) {
        container.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.";
        console.error(e);
    }
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Å—Ç—ã—Ö prompt-–æ–∫–æ–Ω
async function editEvent(ev) {
    const title = prompt("–ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:", ev.title);
    if (title === null) return;
    const date = prompt("–î–∞—Ç–∞ (–ì–ì–ì–ì-–ú–ú-–î–î):", ev.date);
    if (date === null) return;
    const shortInfo = prompt("–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞):", ev.short_info);
    if (shortInfo === null) return;
    const coverUrl = prompt("URL –æ–±–ª–æ–∂–∫–∏ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º):", ev.cover_url || "");
    if (coverUrl === null) return;

    const payload = {
        title: title,
        date: date,
        short_info: shortInfo,
        cover_url: coverUrl || null
    };

    try {
        const res = await fetch("/admin/events/" + ev.id, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Admin-Key": "change-me-admin-key"
            },
            body: JSON.stringify(payload)
        });
        if (!res.ok) {
            const data = await res.json().catch(() => ({}));
            throw new Error(data.detail || "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è");
        }
        await loadEvents();
    } catch (e) {
        alert(e.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ");
        console.error(e);
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
async function deleteEvent(id) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?")) return;
    try {
        const res = await fetch("/admin/events/" + id, {
            method: "DELETE",
            headers: {
                "X-Admin-Key": "change-me-admin-key"
            }
        });
        if (!res.ok) {
            const data = await res.json().catch(() => ({}));
            throw new Error(data.detail || "–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è");
        }
        await loadEvents();
    } catch (e) {
        alert(e.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ");
        console.error(e);
    }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
function initEventForm() {
    const form = document.getElementById("event-form");
    const messageEl = document.getElementById("event-form-message");

    // –ï—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏—à–ª–∏ —Å –∫–∞—Ä—Ç—ã, –±–µ—Ä–µ–º place_name –∏–∑ URL –∏ –ø–æ–¥—Å—Ç–∞–≤–∏–º –≤ –æ–ø–∏—Å–∞–Ω–∏–µ
    const params = new URLSearchParams(window.location.search);
    const placeName = params.get("place_name");
    if (placeName) {
        form.short_info.value = "–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –≤ –ª–æ–∫–∞—Ü–∏–∏: " + placeName;
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        messageEl.textContent = "";
        messageEl.className = "form-message";

        const payload = {
            title: form.title.value,
            date: form.date.value,
            short_info: form.short_info.value,
            cover_url: form.cover_url.value || null
        };

        try {
            const res = await fetch("/admin/events", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    // –î–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∫–ª—é—á –ø—Ä–æ—Å—Ç–æ –∑–∞—à–∏—Ç –≤ –∫–æ–¥.
                    "X-Admin-Key": "change-me-admin-key"
                },
                body: JSON.stringify(payload)
            });
            if (!res.ok) {
                const data = await res.json().catch(() => ({}));
                throw new Error(data.detail || "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è");
            }
            await res.json();
            messageEl.textContent = "–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ.";
            messageEl.classList.add("success");
            form.reset();
            await loadEvents();
        } catch (err) {
            console.error(err);
            messageEl.textContent = err.message || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.";
            messageEl.classList.add("error");
        }
    });
}

document.addEventListener("DOMContentLoaded", () => {
    loadEvents();
    initEventForm();
});
</script>

</body>
</html>

